<!DOCTYPE html>
<html>
<head lang="en">
    <meta charset="UTF-8">
    <title>拖拽</title>
    <style type="text/css">
        *{
            margin:0;
            padding:0;
        }
        .box{
            position:absolute;//这个必须写，不然拖拽的效果实现不了
            top:0;
            left:0;
            width:200px;
            height:200px;
            background:red;
            border-radius: 50%;
            cursor:move;
        }
    </style>
</head>
<body>
<div class="box" id="box"></div>

<script charset="utf-8" src="../js/eventcheng.js" type="text/javascript"></script>
<script charset="utf-8" src="../js/dragcheng.js" type="text/javascript"></script>
<script type="text/javascript">
    var oBox=document.getElementById("box");

    on(oBox,"mousedown",down);
    on(oBox,"selfDragStart",clearEffect);
    on(oBox,"selfDrag",getSpeed);
    on(oBox,"selfDragEnd",fly);
    on(oBox,"selfDragEnd",drop);


    function clearEffect(){
        clearTimeout(this.flyTimer);
        clearTimeout(this.dropTimer);
    }

    function getSpeed(e){
        if(this.posi){
            this.speed=this.offsetLeft-this.posi;
            this.posi=this.offsetLeft;
        }else{
            this.posi=this.offsetLeft;
        }
    }

    function fly(){
        this.speed*=.97;
        var val=this.offsetLeft+this.speed;
        var maxRight=(document.documentElement.clientWidth||document.body.clientWidth)-this.offsetWidth;
        if(val>maxRight){
            this.style.left=val;
            this.speed*=-1;
        }else if(val<0){
            this.style.left=0;
            this.speed*=-1;
        }
        this.style.left=this.offsetLeft+this.speed+"px";

        if(Math.abs(this.speed)>0.5){
            this.flyTimer=setTimeout(processThis(fly,this),30);
        }
    }

    function drop(){
        if(this.dropspeed){
            this.dropspeed+=9.8;
        }else{
            this.dropspeed=9.8;
        }
        this.dropspeed*=0.97;
        var val2=this.offsetTop+this.dropspeed;
        var maxBottom=(document.documentElement.clientHeight||document.body.clientHeight)-this.offsetHeight;
        if(val2>maxBottom){
            this.style.top=maxBottom+"px";
            this.dropspeed*=-1;
            this.flag++
        }else{
            this.style.top=this.offsetTop+this.dropspeed+"px";
            this.flag=0;
        }

        if(this.flag<2){
            this.dropTimer=setTimeout(processThis(drop,this),30);
        }
    }

</script>
</body>
</html>